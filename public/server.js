'use strict';let r=Array(256);function D(b){for(let e=0;256>e;e++)r[e]={i:!1,v:0};b.addEventListener("click",H);b.addEventListener("keydown",e=>{e.preventDefault();e.stopPropagation();r[e.keyCode].i=!0});b.addEventListener("keyup",e=>{e.preventDefault();e.stopPropagation();r[e.keyCode].i=!1})}function H(b){b.preventDefault();b.stopPropagation();b.currentTarget.focus()}function J(){for(let b=0;256>b;b++)r[b].i?r[b].v++:r[b].v=0}let K="undefined"!==typeof AudioContext?new AudioContext:void 0;
function L(...b){M(N(...b))}function M(...b){let e=K.createBuffer(b.length,b[0].length,44100),l=K.createBufferSource();b.map((k,t)=>e.getChannelData(t).set(k));l.buffer=e;l.connect(K.destination);l.start()}
function N(b=1,e=.05,l=220,k=0,t=0,m=.1,u=0,a=1,c=0,f=0,g=0,h=0,n=0,d=0,p=0,w=0,v=0,E=1,B=0,I=0){let x=2*Math.PI,P=c*=500*x/44100/44100;e=l*=(1+2*e*Math.random()-e)*x/44100;let F=[],z=0,Q=0,q=0,C=1,R=0,S=0,y=0,G,A;k=44100*k+9;B*=44100;t*=44100;m*=44100;v*=44100;f*=500*x/44100**3;p*=x/44100;g*=x/44100;h*=44100;n=44100*n|0;for(A=k+B+t+m+v|0;q<A;F[q++]=y)++S%(100*w|0)||(y=u?1<u?2<u?3<u?Math.sin((z%x)**3):Math.max(Math.min(Math.tan(z),1),-1):1-(2*z/x%2+2)%2:1-4*Math.abs(Math.round(z/x)-z/x):Math.sin(z),
y=(n?1-I+I*Math.sin(x*q/n):1)*(0<y?1:-1)*Math.abs(y)**a*b*.3*(q<k?q/k:q<k+B?1-(q-k)/B*(1-E):q<k+B+t?E:q<A-v?(A-q-v)/m*E:0),y=v?y/2+(v>q?0:(q<A-v?1:(A-q)/v)*F[q-v|0]/2):y),G=(l+=c+=f)*Math.cos(p*Q++),z+=G-G*d*(1-1E9*(Math.sin(q)+1)%2),C&&++C>h&&(l+=g,e+=g,C=0),!n||++R%n||(l=e,c=P,C=C||1);return F}let O=1E3/30;
function T(){function b(d){a.l.push({...d,x:a.x,y:a.y})}let e=io({upgrade:!1,transports:["websocket"]}),l=document.querySelector("canvas"),k=l.getContext("2d"),t=document.createElement("canvas");t.width=240;t.height=135;let m=t.getContext("2d"),u=new Image;u.src="i.png";u.onload=()=>{for(let d=0;135>d;d+=8)for(let p=0;240>p;p+=8)m.drawImage(u,32,32,8,8,p,d,8,8)};let a={j:0,g:1,l:[],x:16,y:16};var c=0,f=0;let g=void 0;e.on("u",d=>{if(d&&void 0!==d.h){g=d;for(let p of d.l)if(6===p.g){let w=d.h.find(v=>
v.j===p.A);h.innerHTML+=`<p>[${(null===w||void 0===w?void 0:w.text)||"Unknown"}] says: ${p.text}</p>`}e.emit("u",a);a.l.length=0}});l.addEventListener("click",d=>{L(...[,,90,,.01,.03,4,,,,,,,9,50,.2,,.2,.01]);c=8*Math.floor(d.clientX/l.offsetWidth*240/8);f=8*Math.floor(d.clientY/l.offsetHeight*135/8);d=Math.hypot(c-a.x,f-a.y);b({g:2,s:(c-a.x)/d*4,u:(f-a.y)/d*4})});let h=document.getElementById("chat"),n=document.getElementById("input");n.addEventListener("keydown",d=>{13===d.keyCode&&(b({g:6,text:n.value}),
n.value="")});D(l);window.setInterval(function(){J();if(r[38].i||r[87].i)a.y-=2;if(r[37].i||r[65].i)a.x-=2;if(r[40].i||r[83].i)a.y+=2;if(r[39].i||r[68].i)a.x+=2;k.drawImage(t,0,0);k.fillStyle="white";g?g.h.forEach(d=>{let p=32,w=0;2===d.g?w=p=64:4===d.g?(p=32,w=8):5===d.g&&(p=88,w=8);k.drawImage(u,p,w,8,8,d.x|0,d.y|0,8,8)}):k.fillText("Waiting for server...",2,10)},O)}function U(b,e){b.splice(b.indexOf(e),1)}
function V(){function b(a){a.j=u++;a.m=a.m||100;m.h.push(a);return a}function e(a){if(2===a.g){a.x+=a.s;a.y+=a.u;for(let c=0;c<m.h.length;c++){let f=m.h[c];f.j!==a.j&&f.j!==a.A&&8>Math.hypot(a.x-f.x,a.y-f.y)&&(a.m=0,f.m-=10)}a.m--}5===a.g&&l(a)}function l(a){if(a.o){var c=m.h.find(f=>f.j===a.o);c?(a.x<c.x?a.x+=1:a.x>c.x&&--a.x,a.y<c.y?a.y+=1:a.y>c.y&&--a.y):a.o=void 0}else if(c=k(a,40))a.o=c.j}function k(a,c){let f=void 0;for(let g of m.h)if(1===g.g&&g.j!==a.j){let h=Math.hypot(a.x-g.x,a.y-g.y);h<
c&&(f=g,c=h)}return f}let t=[],m={h:[],l:[]},u=1;b({g:4,x:200,y:50,m:20});b({g:4,x:200,y:60,m:20});b({g:4,x:200,y:70,m:20});b({g:5,x:220,y:70,m:40});setInterval(function(){for(let a=m.h.length-1;0<=a;a--){let c=m.h[a];e(c);0>=c.m&&(U(m.h,c),4!==c.g&&5!==c.g||setTimeout(()=>{c.m=20;c.o=void 0;b(c)},1E4))}},33);module.exports=a=>{function c(){a.emit("u",{...m,B:f.j,l:g.l});g.l.length=0}let f=b({g:1,text:"Player"+u,x:0,y:0}),g={D:a,C:f,l:[]};t.push(g);a.on("disconnect",()=>{U(t,g);U(m.h,f)});a.on("u",
h=>{if(h&&void 0!==h.x&&void 0!==h.y){f.x=h.x;f.y=h.y;f.s=h.s;f.u=h.u;if(h.l)for(let n of h.l)switch(JSON.stringify(n),n.A=f.j,n.g){case 2:b(n);break;case 6:for(let d of t)d.l.push(n)}c()}});c()}}"undefined"!==typeof module?V():T()
